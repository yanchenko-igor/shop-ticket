{# this text is placed by the satchmo_order template tag "order_tracking_details" #}
{% load i18n %}
{% load thumbnail %}
{% load satchmo_currency %}
{% load satchmo_checkout %}
{% load satchmo_util normalize_decimal %}

<div class="orderdetails">
    <h4>{% trans 'Order #' %} {{ order.id }}</h4>
    <h4>{% trans 'Status' %}</h4>
    {% for status in order.orderstatus_set.all %}
        <p>{{status.time_stamp|date:"F jS Y H:i" }}: {{ status.status|status_label }}<br/>
            {% if status.notes %}<i>{% trans status.notes %}</i>{% endif %}
        </p>
    {% endfor %}

    <div class="wraper_order">
        <table class="table_heading_basket">
            <tbody>
                <tr>
                    <th>Предстоящее событие</th>
                    <th class="basked_td_ticket">Количество и места</th>
                </tr>
            </tbody>
        </table>


        {% for item in order.orderitem_set.all %}
            {% ifchanged item.product.ticket.event %}
                {% if not forloop.first %}
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class='curve_bott'>
                            <div>
                                <span class='curve_gray'>
                                    <!--  -->
                                </span>
                            </div>
                        </div>
                    </div>
                {% endif %}
                <div id='item-{{item.id}}' class='basked_bl item'>
                    <div class='curve_top'>
                        <div>
                            <span class='curve_gray'>
                                <!--  -->
                            </span>
                        </div>
                    </div>
                    <div class='curve_body basket_grey'>
                        <table class='basket_tab'>
                            <tbody>
                                <tr>
                                    <td class='basket_td_img'>
                                        <div class='basket_td_img_bl'>
                                            {% if item.product.ticket.event.product.main_image.picture|is_portrait %}
                                                {% thumbnail item.product.ticket.event.product.main_image.picture "107x76" crop="50% 25%" as image %}
                                                    <a href='{{ item.product.ticket.event.product.get_absolute_url }}'>
                                                        <img src='{{ image.url }}' height='{{ image.height }}' width='{{ image.width }}' />
                                                    </a>
                                                {% endthumbnail %}
                                            {% else %}
                                                {% thumbnail item.product.ticket.event.product.main_image.picture "107x76" crop="center" as image %}
                                                    <a href='{{ item.product.ticket.event.product.get_absolute_url }}'>
                                                      <img src='{{ image.url }}' height='{{ image.height }}' width='{{ image.width }}' />
                                                    </a>
                                                {% endthumbnail %}
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td class='basked_td_inf'>
                                        <div class='basked_td_inf_date'>
                                            <span>
                                                {{ item.product.ticket.datetime.datetime|date:"j E Y, l" }}
                                            </span>
                                            {{ item.product.ticket.datetime.datetime|date:"H:i" }}
                                        </div>
                                        <div class='basked_td_inf_txt'>
                                            {{ item.product.ticket.event.product.name }}
                                            {{ item.product.ticket.event.product.short_description }}
                                        </div>
                                    </td>
                                    <td class='basked_td_ticket'>
            {% endifchanged %}
                                    {% ifchanged item.product.ticket.event item.product.ticket.seat.section %}
                                        <div class='basked_td_ticket_cont'>
                                            {{ item.product.ticket.seat.section.name }}
                                        </div>
                                    {% endifchanged %}
                                        <p>
                                            {{ item.product.ticket.seat.row }}
                                            Ряд,
                                            {{ item.product.ticket.seat.col }}
                                            Место
                                        </p>
            {% if forloop.last %}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class='curve_bott'>
                        <div>
                            <span class='curve_gray'>
                                <!--  -->
                            </span>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endfor %}


    </div>

    <h2 class="order_header">Данные о заказе</h2>
    <form class="base_form order_form readonly_form" action="">
        <div class="fieldset">
            <h4 class="fieldset_name">{% trans "Contact Information" %}</h4>
            <div class="field"><label>Имя, фамилия</label> {{ order.contact.full_name }}</div>
            <div class="field"><label>Email</label> {{ order.contact.email }}</div>
            <div class="field"><label>Телефон</label> {{ order.contact.primary_phone.phone }}</div>
        </div>
        {% if order.is_shippable %}
            <div class="fieldset">
                <h4 class="fieldset_name">Доставка</h4>
                <div class="field"><label>Адрес доставки</label> {{ order.ship_country_name|title }} {{ order.ship_postal_code }} {{ order.ship_state }} {{ order.ship_city }} {{ order.full_ship_street|linebreaksbr }} </div>
                <div class="field"><label>Способ доставки</label> {{ order.shipping_method }}</div>
                <div class="field"><label>Стоимости доставки</label> {{order.shipping_cost|currency}}</div>
            </div>
        {% endif %}{# order.is_shippable #}
        <div class="fieldset">
            <h4 class="fieldset_name">Оплата</h4>
            <div class="field"><label>Способ оплаты</label> {% trans "COD" %}</div>
            <div class="field"><label>Доставка</label> + {{order.shipping_cost|currency}}</div>
            <div class="field"><label>{% trans "Total" %}</label> {{order.total|currency}}</div>
        </div>
    </form>


</div>
