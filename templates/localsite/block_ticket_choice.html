{% for form in forms %}
    {{ form.as_p }}
{% endfor %}

{#{ event.hallscheme.map|safe }#}
<object id="hallmap" width="640" height="480" ></object>
<script type="text/javascript">
var get_ticket_values = function() {
    $.post('{% url ajax_select_ticket %}', {
        csrfmiddlewaretoken: getCookie('csrftoken'),
        section: $('#id_section').val(),
        datetime: $('#id_datetime').val()
    },
    function(data) {
	    $('#id_ticket').html("");//clear old options
		data = eval(data);//get json array
		for (i = 0; i < data.length; i++)//iterate over all options
		{
			for ( key in data[i] )//get key => value
			{	
				$('#id_ticket').get(0).add(new Option(data[i][key],[key]), document.all ? i : null);
            }
		}
		$("option:first", '#id_ticket').attr( "selected", "selected" );//select first option
     },
     'json'
);
}
$(function() {
        $('#id_datetime').change(function() {
            $('#hallmap').attr('data', '/hallmap/' + $(this).val() + '/');
        });
        $('#id_section').change(function() {
            get_ticket_values();
        });
        $('#id_ticket').change(function() {
            var postdata = {csrfmiddlewaretoken: getCookie('csrftoken')};
            postdata[$(this).attr('name')] = $(this).val();
            $.post('{% url add_ticket %}', postdata,
                function(data) {
                    $("#cart_count").text(data.cart_count);
                },
                'json'
            );
        });
});
</script>
